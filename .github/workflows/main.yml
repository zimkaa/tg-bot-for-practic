name: ci

on:
  push:
    branches:
      - 'main'

  pull_request:
    branches:
      - '*'

jobs:
  # docker:
  #   runs-on: ubuntu-latest
  #   steps:
  #     -
  #       name: Set up QEMU
  #       uses: docker/setup-qemu-action@v3
  #     -
  #       name: Set up Docker Buildx
  #       uses: docker/setup-buildx-action@v3
  #     -
  #       name: Login to Docker Hub
  #       uses: docker/login-action@v3
  #       with:
  #         username: ${{ secrets.DOCKERHUB_USERNAME }}
  #         password: ${{ secrets.DOCKERHUB_TOKEN }}
  #     -
  #       name: Build and push
  #       uses: docker/build-push-action@v5
  #       with:
  #         push: true
  #         tags: ${{ secrets.DOCKERHUB_USERNAME }}/sales_bot:$APP_VERSION

  # build:
  #   runs-on: ubuntu-latest
  #   steps:
  #   - name: Deploy using ssh
  #     # uses: appleboy/ssh-action@master
  #     uses: appleboy/ssh-action@v1.0.3
  #     with:
  #       host: ${{ secrets.SERVER_HOST }}
  #       username: ${{ secrets.SERVER_USER }}
  #       key: ${{ secrets.SSH_PRIVATE_KEY }}
  #       passphrase: ${{ secrets.KEY_PASSPHRASE }}
  #       port: 22
  #       script: |
  #         cd ~/test_tg/tg-call
  #         git status
  #         # eval `ssh-agent -s`
  #         # echo "${{ secrets.SSH_PRIVATE_KEY }}" > ./key
  #         # chmod 600 ./key
  #         # ssh-add ./key
  #         # ssh -T git@github.com
  #         docker pull ${{ secrets.DOCKERHUB_USERNAME }}/sales_bot:$APP_VERSION

  test:
    runs-on: ubuntu-latest
    if: ${{ !github.event.act }}
    steps:
    - name: Connect using ssh
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.SERVER_HOST }}
        username: ${{ secrets.SERVER_USER }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        port: 22
        script: |
          echo "Docker user: ${{ vars.DOCKERHUB_USERNAME }}"
          echo "Server host: ${{ secrets.SERVER_HOST }}"
          echo "Server user: ${{ secrets.SERVER_USER }}"
          echo "Server key: ${{ secrets.SSH_PRIVATE_KEY }}"

  # test2:
  #   runs-on: ubuntu-latest
  #   steps:
  #   - name: Connect using ssh
  #     if: ${{ !env.ACT }}
  #     uses: appleboy/ssh-action@v1.0.3
  #     with:
  #       host: ${{ secrets.SERVER_HOST }}
  #       username: ${{ secrets.SERVER_USER }}
  #       key: ${{ secrets.SSH_PRIVATE_KEY }}
  #       port: 22
  #       script: |
  #         echo "Docker user: ${{ vars.DOCKERHUB_USERNAME }}"
  #         echo "Server host: ${{ secrets.SERVER_HOST }}"
  #         echo "Server user: ${{ secrets.SERVER_USER }}"
  #         echo "Server key: ${{ secrets.SSH_PRIVATE_KEY }}"

  test3:
    runs-on: ubuntu-latest
    steps:
    - name: Connect using ssh
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.SERVER_HOST }}
        username: ${{ secrets.SERVER_USER }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        passphrase: ${{ secrets.KEY_PASSPHRASE }}
        port: 22
        script: |
          echo "Docker user: ${{ vars.DOCKERHUB_USERNAME }}"
          ls -la
          cd ~/test_action/
          pwd
          # git status
